<div class="updates-feed">
  <div class="feed-header">
    <h3>Latest Updates</h3>
    <a href="{{ '/updates/' | relative_url }}" class="see-all">View all &rarr;</a>
  </div>
  <div class="feed-viewport" id="feed-viewport">
    <div class="feed-track" id="feed-track">
      {% assign sorted_updates = site.updates | sort: 'date' | reverse %}
      {% for update in sorted_updates %}
      <a href="{{ update.url | relative_url }}" class="feed-item">
        <div class="feed-item-header">
          <span class="feed-date">{{ update.date | date: "%b %-d" }}</span>
          <span class="feed-type type-{{ update.type }}">{{ update.type | replace: '-', ' ' }}</span>
        </div>
        <span class="feed-title">{{ update.title }}</span>
      </a>
      {% endfor %}
      {% for update in sorted_updates %}
      <a href="{{ update.url | relative_url }}" class="feed-item" aria-hidden="true">
        <div class="feed-item-header">
          <span class="feed-date">{{ update.date | date: "%b %-d" }}</span>
          <span class="feed-type type-{{ update.type }}">{{ update.type | replace: '-', ' ' }}</span>
        </div>
        <span class="feed-title">{{ update.title }}</span>
      </a>
      {% endfor %}
    </div>
  </div>
</div>

<script>
(function() {
  var track = document.getElementById('feed-track');
  var viewport = document.getElementById('feed-viewport');
  if (!track || !viewport) return;
  var paused = false;
  viewport.addEventListener('mouseenter', function() {
    paused = true;
    track.style.transform = 'none';
  });
  viewport.addEventListener('mouseleave', function() {
    paused = false;
    pos = 0;
  });
  var pos = 0;
  var speed = 0.4;
  var halfHeight = 0;

  function measure() {
    // Measure height of the first set of items (half the track)
    var items = track.querySelectorAll('.feed-item:not([aria-hidden])');
    var h = 0;
    for (var i = 0; i < items.length; i++) {
      h += items[i].offsetHeight;
    }
    halfHeight = h;
  }

  // Measure after fonts/layout settle
  setTimeout(function() {
    measure();
    if (halfHeight <= 0) return;
    function animate() {
      if (!paused) {
        pos -= speed;
        if (Math.abs(pos) >= halfHeight) pos = 0;
        track.style.transform = 'translateY(' + pos + 'px)';
      }
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
  }, 200);
})();
</script>
